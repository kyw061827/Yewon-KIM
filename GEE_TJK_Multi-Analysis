// ScriptPath Link: https://code.earthengine.google.com/?scriptPath=users%2Fkyw061827%2FYewon-KIM%3ATJK_MultiLayer_GEE_Analysis

// 타지키스탄 전체가 보이도록 지도 중심 설정
Map.setCenter(71, 38.5, 6);

// FAO GAUL 데이터셋에서 국가 경계 불러오기
var countries = ee.FeatureCollection("FAO/GAUL/2015/level0");
var tajikistan = countries.filter(ee.Filter.eq('ADM0_NAME', 'Tajikistan'));

// areaBoundary를 국가 전체로 설정
var areaBoundary = tajikistan;

// Permanent water (class 3)
var jrcSurfaceWater = ee.ImageCollection('JRC/GSW1_3/YearlyHistory')
  .filter(ee.Filter.calendarRange(2000, 2000, 'year'))
  .map(function(image) {
    return image.select('waterClass').eq(3);
  })
  .sum()
  .clip(areaBoundary);

jrcSurfaceWater = jrcSurfaceWater.updateMask(jrcSurfaceWater.gt(0));
var jrcSurfaceWaterVis = {min: 0, max: 1, palette: ['#00008B']};

// Flooded water (class 2)
var jrcSurfaceFlood = ee.ImageCollection('JRC/GSW1_3/YearlyHistory')
  .filter(ee.Filter.calendarRange(2000, 2000, 'year'))
  .map(function(image) {
    return image.select('waterClass').eq(2);
  })
  .sum()
  .clip(areaBoundary);

jrcSurfaceFlood = jrcSurfaceFlood.updateMask(jrcSurfaceFlood.gt(0));
var jrcSurfaceFloodVis = {min: 0, max: 1, palette: ['#FD0303']};

// Land cover
var LCLU = ee.ImageCollection("ESA/WorldCover/v200")
  .first()
  .clip(areaBoundary);

// Population density
var PopulationDensity = ee.Image('CIESIN/GPWv411/GPW_UNWPP-Adjusted_Population_Density/gpw_v4_population_density_adjusted_to_2015_unwpp_country_totals_rev11_2020_30_sec')
  .clip(areaBoundary);
var PopulationDensityVis = {
  min: 0.0,
  max: 1000,
  palette: ['ffffe7','FFc869','ffac1d','e17735','f2552c','9f0c21']
};

// Soil texture
var SoilTexture = ee.Image('OpenLandMap/SOL/SOL_TEXTURE-CLASS_USDA-TT_M/v02')
  .select('b10')
  .clip(areaBoundary);
var SoilTextureVis = {
  min: 1.0,
  max: 12.0,
  palette: ['d5c36b','b96947','9d3706','ae868f','f86714','46d143','368f20','3e5a14','ffd557','fff72e','ff5a9d','ff005b']
};

// Healthcare access
var HealthCareAccess = ee.Image('Oxford/MAP/accessibility_to_healthcare_2019')
  .select('accessibility')
  .clip(areaBoundary);
var HealthCareAccessVis = {
  min: 1,
  max: 60,
  palette: ['FFF8DC','FFEBCD','FFDEAD','F5DEB3','DEB887','D2B48C','CD853F','8B4513','A0522D','8B4513']
};

// Add layers
Map.addLayer(jrcSurfaceWater, jrcSurfaceWaterVis, 'Permanent Water Data');
Map.addLayer(jrcSurfaceFlood, jrcSurfaceFloodVis, 'Inundated Area Data');
Map.addLayer(LCLU, {}, "LCLU");
Map.addLayer(PopulationDensity, PopulationDensityVis, 'PopulationDensity');
Map.addLayer(SoilTexture, SoilTextureVis, 'Soil texture class (USDA system)');
Map.addLayer(HealthCareAccess, HealthCareAccessVis, 'HealthCareAccessibility');
Map.addLayer(areaBoundary, {}, 'Boundary');

// Print
print('Permanent Water', jrcSurfaceWater);
print('Flooded Water', jrcSurfaceFlood);
print('Land Cover', LCLU);
print('Population Density', PopulationDensity);
print('Soil Texture', SoilTexture);
print('Healthcare Access', HealthCareAccess);
print('Boundary', areaBoundary);

// Export
// Permanent Water
Export.image.toDrive({
  image: jrcSurfaceWater,
  description: 'PermanentWater_Tajikistan',
  scale: 30,
  region: areaBoundary,
  maxPixels: 1e13
});

// Flooded Water
Export.image.toDrive({
  image: jrcSurfaceFlood,
  description: 'FloodedWater_Tajikistan',
  scale: 30,
  region: areaBoundary,
  maxPixels: 1e13
});

// Land Cover
Export.image.toDrive({
  image: LCLU,
  description: 'LandCover_Tajikistan',
  scale: 10,
  region: areaBoundary,
  maxPixels: 1e13
});

// Population Density
Export.image.toDrive({
  image: PopulationDensity,
  description: 'PopulationDensity_Tajikistan',
  scale: 1000,
  region: areaBoundary,
  maxPixels: 1e13
});

// Soil Texture
Export.image.toDrive({
  image: SoilTexture,
  description: 'SoilTexture_Tajikistan',
  scale: 250,
  region: areaBoundary,
  maxPixels: 1e13
});

// Healthcare Access
Export.image.toDrive({
  image: HealthCareAccess,
  description: 'HealthcareAccess_Tajikistan',
  scale: 1000,
  region: areaBoundary,
  maxPixels: 1e13
});

// Boundary (FeatureCollection → GeoJSON)
Export.table.toDrive({
  collection: areaBoundary,
  description: 'TajikistanBoundary',
  fileFormat: 'GeoJSON'
});
